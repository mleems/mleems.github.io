---
layout: post
title: z/OS 虚拟环境在Windows上的搭建
categories: 大型机 系统管理
tags: [Mainframe,Windows,OS]
---
<p><div class="toc"><div class="toc">
<ul>
<li><a href="#写在前面">〇、写在前面</a></li>
<li><a href="#一准备工作">一、准备工作</a><ul>
<li><a href="#硬件准备">1. 硬件准备</a></li>
<li><a href="#软件准备">2.软件准备</a></li>
<li><a href="#卷文件准备">3.卷文件准备</a></li>
</ul>
</li>
<li><a href="#二软件安装">二、软件安装</a><ul>
<li><a href="#安装hercules">1. 安装Hercules</a></li>
<li><a href="#安装winpcap">2. 安装WinPcap</a></li>
<li><a href="#安装vc运行库">3. 安装VC运行库</a></li>
<li><a href="#安装tcpip支持">4. 安装TCP/IP支持</a></li>
<li><a href="#安装客户端">5. 安装3270客户端</a></li>
<li><a href="#安装虚拟网卡">6. 安装虚拟网卡 *</a></li>
</ul>
</li>
<li><a href="#三配置文件">三、配置文件</a></li>
<li><a href="#四配置大机">四、配置大机</a><ul>
<li><a href="#使用hercules开机">1. 使用Hercules开机</a></li>
<li><a href="#配置tcpip">2. 配置TCP/IP</a></li>
<li><a href="#再次ipl">3. 再次IPL</a></li>
<li><a href="#配置uss-ssh">4. 配置USS ssh</a></li>
</ul>
</li>
<li><a href="#五结语">五、结语</a></li>
<li><a href="#六附录资源列表">六、附录：资源列表</a></li>
</ul>
</div>
</div>
</p>

<h1 class="wmd-title" id="写在前面">〇、写在前面</h1>

<hr>

<p>这篇文章主要介绍如何在PC上来模拟大型机系统 z/OS 的运行环境, 面向有一定基础的做主机方向的读者群。</p>

<p>通过本文你可以学会如何自行搭建一个大机的虚拟环境以作开发、测试、折腾之用。</p>

<p>希望本文对你有所帮助，那么开始吧！</p>

<h1 class="wmd-title" id="一准备工作">一、准备工作</h1>

<hr>

<h2 class="wmd-title" id="硬件准备">1. 硬件准备</h2>

<ul>
<li>一台配置中等或以上的PC/笔记本</li>
<li>最少10GB的硬盘空间</li>
<li>最少2GB的内存</li>
<li>一个支持虚拟化的CPU</li>
</ul>

<h2 class="wmd-title" id="软件准备">2.软件准备</h2>

<ul>
<li>大机模拟器——Hercules</li>
<li>TCP/IP支持——WinPcap（4.1.1版本及以上）</li>
<li>TCP/IP支持——CTCI-W32</li>
<li>GUI支持——FishLib * 非必须</li>
<li>图形界面GUI——HercGUI * 非必须</li>
<li>3270客户端——IBM Personal Communication 或 Vista TN 3270</li>
<li>VC 2005 和 VC 2008 的运行库</li>
</ul><h2 class="wmd-title" id="卷文件准备">3.卷文件准备</h2>

<ul>
<li>IBM只向内部员工或合作伙伴提供, 但其实可以通过某些非正常途径弄到...╭(╯^╰)╮</li>
<li>本文中所用卷文件是 z/OS 1.9 版本</li>
</ul>

<blockquote>
  <ul>
  <li>上面提到的软件会在文末给出（顺便悄悄地放出卷文件下载链接</li>
  <li>本文教程中并未使用GUI工具，也不推荐使用。虽然某种意义上会简化操作，但个人觉得不利于理解大机的一些特性。而且如果使用还得花时间去熟悉界面以及各种操作，未见得就比命令行简单。</li>
  </ul>
</blockquote><h1 class="wmd-title" id="二软件安装">二、软件安装</h1>

<hr>

<h2 class="wmd-title" id="安装hercules">1. 安装Hercules</h2>

<p>需要注意的是安装路径最好为全英文以免之后遇到不必要的麻烦。</p>

<p>32位的Hercules最多只能为虚拟大机分配1G多点的内存，如果想为大机多分配内存提升性能的话可以选64位版本(推荐)。</p>

<h2 class="wmd-title" id="安装winpcap">2. 安装WinPcap</h2>

<p>全程默认就好，注意杀软放行。</p>

<h2 class="wmd-title" id="安装vc运行库">3. 安装VC运行库</h2>

<p>32位系统只安装32位就可以，64位系统需要把32&amp;64位全部安装</p>

<h2 class="wmd-title" id="安装tcpip支持">4. 安装TCP/IP支持</h2>

<p>把CTCI和Fishlib中的文件解压到Hercules的根目录下。</p>

<p>例如：Hercules安装在 D:\Hercules</p>

<p>CTCI压缩包内文件结构为：</p>

<pre class="prettyprint prettyprinted" style=""><code><span class="pun">|--</span><span class="pln">bin
    </span><span class="pun">|--</span><span class="pln">a
    </span><span class="pun">|--</span><span class="pln">b
    </span><span class="pun">|--...</span><span class="pln">
    </span><span class="pun">|--</span><span class="pln">xx
</span><span class="pun">|--</span><span class="pln">x64
    </span><span class="pun">|--</span><span class="pln">bin
      </span><span class="pun">|--</span><span class="pln">aa
      </span><span class="pun">|--</span><span class="pln">bb
      </span><span class="pun">|--...</span><span class="pln">
      </span><span class="pun">|--</span><span class="pln">xxxx</span></code></pre>

<p>32位系统将<code>bin</code>中的文件解压到Hercules安装目录，64位系统需要分别将<code>bin</code>和<code>x64/bin</code>中的文件解压到Hercules安装目录</p>

<p>Fishlib的解压方法同理。</p><h2 class="wmd-title" id="安装客户端">5. 安装3270客户端</h2>

<p>这一步还是主要安装路径最好全英文</p>

<h2 class="wmd-title" id="安装虚拟网卡">6. 安装虚拟网卡 *</h2>

<p>这一步不是必须的，只是为了之后的大机虚拟环境可以不受宿主机PC网络环境变化的影响。
步骤（以Win7系统为例）：</p>

<pre class="prettyprint prettyprinted" style=""><code><span class="lit">1.</span><span class="pln"> </span><span class="pun">右键“计算机”——管理</span><span class="pln">

</span><span class="lit">2.</span><span class="pln"> </span><span class="pun">选择“设备管理器”，这时右边会列出你</span><span class="pln">PC</span><span class="pun">上的所有设备</span><span class="pln">

</span><span class="lit">3.</span><span class="pln"> </span><span class="pun">右键右边第一行（你</span><span class="pln">PC</span><span class="pun">的名字）——添加过时硬件——下一步</span><span class="pln">

</span><span class="lit">4.</span><span class="pln"> </span><span class="pun">选择“安装我手动从列表选择的硬件”——下一步</span><span class="pln">

</span><span class="lit">5.</span><span class="pln"> </span><span class="pun">选择“网络适配器”——下一步</span><span class="pln">

</span><span class="lit">6.</span><span class="pln"> </span><span class="pun">厂商“</span><span class="typ">Microsoft</span><span class="pun">”——网络适配器“</span><span class="typ">Microsoft</span><span class="pln"> </span><span class="typ">Loopback</span><span class="pln"> </span><span class="typ">Adapter</span><span class="pun">”——下一步</span></code></pre>

<p>至此，虚拟网卡就添加完成了（名字通常是“本地连接2”）。</p>

<h1 class="wmd-title" id="三配置文件">三、配置文件</h1>

<hr>

<p>这里将通过一份已有的配置文件来进行讲解主要配置参数，详细的参数解释可以去看Hercules的官方文档</p>

<p>配置文件示例如下：</p>

<pre class="prettyprint prettyprinted" style=""><code><span class="com"># Sample configuration file for Hercules ESA/390 emulator</span><span class="pln">
ARCHMODE  z</span><span class="pun">/</span><span class="typ">Arch</span><span class="pln">  </span><span class="com">#系统架构，可选：z/Arch(64Bit),S/370, ESA/390 or ESAME</span><span class="pln">
ALRF      ENABLE
CNSLPORT  </span><span class="lit">3270</span><span class="pln">    </span><span class="com">#Hercules监听端口</span><span class="pln">
CONKPALV  </span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="lit">1</span><span class="pun">,</span><span class="lit">10</span><span class="pun">)</span><span class="pln">
CPUMODEL  </span><span class="lit">3090</span><span class="pln">
CPUSERIAL </span><span class="lit">012345</span><span class="pln">
DIAG8CMD  ENABLE
ECPSVM    NO
LOADPARM  </span><span class="lit">0A83MYM1</span><span class="pln"> </span><span class="com">#IPL启动参数</span><span class="pln">
LPARNAME  HERCULES </span><span class="com">#逻辑分区（logic partition）名称</span><span class="pln">
MAINSIZE  </span><span class="lit">2048</span><span class="pln">     </span><span class="com">#为虚拟大机分配的最大内存</span><span class="pln">
MOUNTED_TAPE_REINIT  DISALLOW
NUMCPU    </span><span class="lit">4</span><span class="pln">        </span><span class="com">#为虚拟大机分配的CPU core数量（不超过你PC的最大Core）</span><span class="pln">
OSTAILOR  Z</span><span class="pun">/</span><span class="pln">OS
PANRATE   </span><span class="lit">80</span><span class="pln">       </span><span class="com">#面板刷新频率</span><span class="pln">
PGMPRDOS  LICENSED
SHCMDOPT  NODIAG8
SYSEPOCH  </span><span class="lit">1900</span><span class="pln">    </span><span class="com">######</span><span class="pln">
TIMERINT  </span><span class="lit">50</span><span class="pln">      </span><span class="com">#时区控制相关</span><span class="pln">
TZOFFSET  </span><span class="pun">+</span><span class="lit">1400</span><span class="pln">   </span><span class="com">#</span><span class="pln">
YROFFSET  </span><span class="lit">0</span><span class="pln">       </span><span class="com">#</span><span class="pln">
HERCPRIO  </span><span class="lit">0</span><span class="pln">       </span><span class="com">######</span><span class="pln">
TODPRIO   </span><span class="pun">-</span><span class="lit">20</span><span class="pln">     </span><span class="com"># 设置优先级</span><span class="pln">
DEVPRIO   </span><span class="lit">8</span><span class="pln">       </span><span class="com">#</span><span class="pln">
CPUPRIO   </span><span class="lit">0</span><span class="pln">       </span><span class="com">###### </span><span class="pln">
PANTITLE  </span><span class="str">"z/OS 1.9 IPL A80"</span><span class="pln">  </span><span class="com">#控制面板名</span><span class="pln">

</span><span class="com"># Display Terminals  3270   TERMINAL</span><span class="pln">
</span><span class="lit">0700.10</span><span class="pln">  </span><span class="lit">3270</span><span class="pln">
</span><span class="com">#  |       |----设备类型，3270表示3270客户端</span><span class="pln">
</span><span class="com">#  |</span><span class="pln">
</span><span class="com">#  |--------------------0700是设备号（16进制），后面的.10表示从0700开始的10个设备</span><span class="pln">
</span><span class="com">#</span><span class="pln">

</span><span class="com"># DASD Devices</span><span class="pln">
</span><span class="com"># IBM Emulation Files</span><span class="pln">
</span><span class="lit">0A80</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9RES1.CCKD</span><span class="pln">
</span><span class="lit">0A81</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9RES2.CCKD</span><span class="pln">
</span><span class="lit">0A82</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9RES3.CCKD</span><span class="pln">
</span><span class="lit">0A83</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9SYS1.CCKD</span><span class="pln">
</span><span class="lit">0A84</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9USS1.CCKD</span><span class="pln">
</span><span class="lit">0A85</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9PRD1.CCKD</span><span class="pln">
</span><span class="lit">0A86</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9DIS1.CCKD</span><span class="pln">
</span><span class="lit">0A87</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9DIS2.CCKD</span><span class="pln">
</span><span class="lit">0A88</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9DIS3.CCKD</span><span class="pln">
</span><span class="lit">0A89</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9DIS4.CCKD</span><span class="pln">
</span><span class="lit">0A8A</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9DIS5.CCKD</span><span class="pln">
</span><span class="lit">0A8B</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9DIS6.CCKD</span><span class="pln">
</span><span class="lit">0A8C</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\SARES1</span><span class="pun">.</span><span class="pln">CCKD
</span><span class="lit">0A8D</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9CIC1.CCKD</span><span class="pln">
</span><span class="lit">0A8E</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9DB81.CCKD</span><span class="pln">
</span><span class="lit">0A8F</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9DB82.CCKD</span><span class="pln">
</span><span class="lit">0A90</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9DB91.CCKD</span><span class="pln">
</span><span class="lit">0A91</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9DB92.CCKD</span><span class="pln">
</span><span class="lit">0A92</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9IMS1.CCKD</span><span class="pln">
</span><span class="lit">0A93</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9WAS1.CCKD</span><span class="pln">
</span><span class="lit">0A94</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9WAS2.CCKD</span><span class="pln">
</span><span class="lit">0A95</span><span class="pln">    </span><span class="lit">3390</span><span class="pln">    </span><span class="pun">..</span><span class="pln">\CCKD\zOS_1</span><span class="pun">.</span><span class="lit">9</span><span class="pln">\IBM\Z</span><span class="lit">9WAS3.CCKD</span><span class="pln">
</span><span class="com"># |       |             |</span><span class="pln">
</span><span class="com"># |       |             |-----卷文件路径，一般为绝对路径，也可用相对路径（方便拷贝）</span><span class="pln">
</span><span class="com"># |       |</span><span class="pln">
</span><span class="com"># |       |---------设备类型，3390表示IBM3390型磁盘，3390-3、3390-9型等磁盘这一都写为3390</span><span class="pln">
</span><span class="com"># |</span><span class="pln">
</span><span class="com"># |------------设备号</span><span class="pln">

</span><span class="com">#                                                |---192.168.16.250 是为虚拟大机</span><span class="pln">
</span><span class="com">#                                                |   分配的IP地址 </span><span class="pln">
</span><span class="com"># CTC Adapters                                   |</span><span class="pln">
</span><span class="lit">0E20</span><span class="pun">.</span><span class="lit">2</span><span class="pln">  </span><span class="lit">3088</span><span class="pln">    CTCI </span><span class="pun">-</span><span class="pln">n </span><span class="lit">00</span><span class="pun">-</span><span class="lit">50</span><span class="pun">-</span><span class="lit">56</span><span class="pun">-</span><span class="pln">C0</span><span class="pun">-</span><span class="lit">00</span><span class="pun">-</span><span class="lit">01</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">16.250</span><span class="pln"> </span><span class="lit">0.0</span><span class="pun">.</span><span class="lit">0.0</span><span class="pln">
</span><span class="com"># |       |     -------------------------                 -------</span><span class="pln">
</span><span class="com"># |       |              |-----CTCI -n 用来指定刚才创建的虚拟网卡mac地址</span><span class="pln">
</span><span class="com"># |       |                            后面的0.0.0.0表示用这个mac地址来找网卡</span><span class="pln">
</span><span class="com"># |       |</span><span class="pln">
</span><span class="com"># |       |---3088表示网络设备</span><span class="pln">
</span><span class="com"># |</span><span class="pln">
</span><span class="com"># |---设备号</span></code></pre>

<p>对配置文件中IP配置的说明：</p>

<p>你需要在cmd命令行中执行<code>ipconfig /all</code>命令来查看刚才创建的虚拟网卡的mac地址。
并配置虚拟网卡的ip和掩码（本地连接2——属性——...不再赘述）</p>

<p>例如将虚拟网卡IP设置为<code>192.168.16.1</code>，掩码设置为<code>255.255.255.0</code></p>

<p>按照配置文件中的写法，Hercules根据你提供的mac地址将会找到虚拟网卡，并以该网卡的ip为网关来与虚拟大机进行通信（需确保设置的网卡IP和大机IP在同一网段）</p>

<p>至此，大机虚拟环境搭建的准备与配置全部完成，可以开机（IPL）啦！</p>

<h1 class="wmd-title" id="四配置大机">四、配置大机</h1>

<hr>

<h2 class="wmd-title" id="使用hercules开机">1. 使用Hercules开机</h2>

<p>还是用代码说话，如下</p>

<pre class="prettyprint prettyprinted" style=""><code><span class="lit">@echo</span><span class="pln"> off
chdir </span><span class="typ">Conf</span><span class="pln">
</span><span class="str">"Hercules\x64\hercules.exe"</span><span class="pln"> </span><span class="pun">-</span><span class="pln">f </span><span class="str">"Conf\zOS_1.9.cnf"</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="str">"Logs\%username% zOS_1.9 %date:~0,4%%date:~5,2%%date:~8,2% %time:~0,2%%time:~3,2%%time:~6,2%.log"</span></code></pre>

<p>可以把上面代码另存为<code>.bat</code>或<code>.cmd</code>文件。</p>

<p>其中</p>

<p><code>"Hercules\x64\hercules.exe"</code>是Hercules可执行文件的相对或绝对路径，需要改成适合你自己的。</p>

<p><code>-f</code>选项用来指定Hercules的配置文件。</p>

<p><code>"Conf\zOS_1.9.cnf"</code>是配置文件的绝对或相对路径，需要改成你自己的。</p>

<p><code>&gt; "Logs\...</code>表示日志文件的存储路径及记录格式，可以根据自己的需要修改。</p>

<p>执行上面命令后就可以看见Hercules的主控台面板了
<img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/00-control-panel.png" alt="control-panel" title="control-panel"></p>

<p>图 00-主控台面板</p>

<p><code>TUN device tun0 opend</code>说明TCP/IP支持没有问题，如果显示failed，你可能就得看看是不是哪里出错了</p>

<p><code>Command ==&gt;</code>处用来输入控制命令</p>

<p>用3270客户端连接<code>127.0.0.1</code>的<code>3270</code>端口，主控台上看到有客户端连接后在<code>Command</code>处输入<code>ipl 0a80</code>，其中<code>0a80</code>是配置文件中你为<code>Z9RES1.CCKD</code>盘卷分配的设备号，该卷也叫“系统驻留卷”，更多详细信息请戳IBM红皮书。</p>

<p>输入<code>ipl 0a80</code>后你会在3270客户端看到一系列变化，初次启动时会需要你回复系统一些信息，根据系统提示回复即可，比如图01</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/01-first-ipl.png" alt="first-ipl" title="first-ipl"></p>

<p>图 01-首次IPL</p>

<h2 class="wmd-title" id="配置tcpip">2. 配置TCP/IP</h2>

<p>等待大概2-3分钟后系统就启动好了，这时你需要另外开启一个3270客户端进行登录。</p>

<p>我们要对系统进行一系列的配置所以用内置的超级管理员账号<code>ibmuser</code>登录，默认密码<code>sys1</code>。</p>

<p>登录到系统后去SDSF面板查看与TCP/IP相关的作业。</p>

<p>如果发现作业队列什么都没显示的话可以使用<code>prefix **</code>命令显示所有作业。如图02</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/02-display-jobs.png" alt="display-jobs" title="display-jobs"></p>

<p>图 02-显示所有作业</p>

<p>找到作业<code>TCPIP</code>并查看</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/03-select-job.png" alt="select-job" title="select-job"></p>

<p>图 03-选择作业</p>

<p>根据作业中DD语句找到指定的TCP/IP配置数据集</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/04-position-dataset.png" alt="04-position-dataset" title="position-dataset"></p>

<p>图 04-定位配置数据集</p>

<p>修改TCP/IP的配置数据集</p>

<p>首先是Profile数据集</p>

<p>在第180行左右，注释掉<code>DEVICE LCS1 E20</code>和<code>LINK ETH1 ETHERNET 0 LCS1</code>并输入</p>

<pre class="prettyprint prettyprinted" style=""><code><span class="pln">DEVICE CTCDEV1 CTC E20
LINK CTCLINK1 CTC </span><span class="lit">0</span><span class="pln"> CTCDEV1
HOME </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">16.250</span><span class="pln"> CTCLINK1</span></code></pre>

<p>如图05-01</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/05-edit-profile-01.png" alt="05-edit-profile-01" title="edit-profile-01"></p>

<p>图 05-01-编辑TCP/IP配置数据集</p>

<p>在第280行左右，注释掉<code>HOME</code>、<code>ETH1</code>、<code>192.168.248 = ETH1 576 0</code>和<code>DEFAULTNET 192.168.248 = ETH1 576 0</code>并输入</p>

<pre class="prettyprint prettyprinted" style=""><code><span class="lit">192.168</span><span class="pun">.</span><span class="lit">16.1</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> CTCLINK1 </span><span class="lit">1500</span><span class="pln"> HOST
DEFAULTNET </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">16.1</span><span class="pln"> CTCLINK1 </span><span class="lit">1500</span><span class="pln"> </span><span class="lit">0</span></code></pre>

<p>如图 05-02</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/05-edit-profile-02.png" alt="05-edit-profile-01" title="edit-profile-02"></p>

<p>图 05-02-编辑TCP/IP配置数据集</p>

<p>把倒数第三行的<code>START LCS1</code>改为<code>START CTCDEV1</code>，保存退出</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/05-edit-profile-03.png" alt="05-edit-profile-03" title="edit-profile-03"></p>

<p>图 05-03-编辑TCP/IP配置数据集</p>

<p>接下来配置<code>TCPDATA</code>数据集，按下图06配置即可</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/06-edit-tcpdata.png" alt="06-edit-tcpdata" title="edit-tcpdata"></p>

<p>图 06-编辑TCPDATA数据集</p>

<p>主要参数解释：</p>

<p><code>HOSTNAME</code>：主机名，之后还会用到。重要！</p>

<p><code>NSINTERADDR</code>：这个是DSN服务器地址，如果想让你的虚拟大机可以访问公网就指定一个可用的DNS地址。如果只是在内网使用随便填一个内网IP就行</p>

<p>修改<code>TCPIP.HOSTS.LOCAL</code>数据集</p>

<p>按照TCPDATA中的主机名仿照图-07修改即可</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/07-edit-hosts.png" alt="07-edit-hosts" title="edit-hosts"></p>

<p>图 07-修改hosts</p>

<p>修改完成后在<code>TCPIP.HOSTS.LOCAL</code>数据集前打<code>MAKESITE</code>命令生成site信息</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/08-makesite.png" alt="08-makesite" title="makesite"></p>

<p>图 08-MakeSite</p>

<p>注意图-09中的makesite信息，可以发现新生成的site信息数据集是以当前用户ID（即IBMUSER）为HLQ的，所以必须把这两个数据集重命名为<code>TCPIP.HOSTS.ADDRINFO</code>和<code>TCPIP.HOSTS.SITEINFO</code>，不然TCP/IP使用的仍是旧的site信息</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/09-makesite-info.png" alt="09-makesite-info" title="makesite-info"></p>

<p>图 09-MakeSite显示信息</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/10-rename.png" alt="10-rename" title="rename"></p>

<p>图 10-重命名</p>

<p>下面把所有HFS数据集CATALOG，这和USS有关</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/11-catalog-dataset-01.png" alt="11-catalog-dataset-01" title="catalog-dataset-01"></p>

<p>图 11-01-编目HFS数据集</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/11-catalog-dataset-02.png" alt="11-catalog-dataset-02" title="catalog-dataset-02"></p>

<p>图 11-02-编目HFS数据集</p>

<p>至此，TCP/IP部分的配置已完毕，我们需要重新IPL一下来检验是否配置正确。在3270客户端的控制面板（不是主控台的控制面板，是打开的第一个3270客户端）输入<code>S SHUTDOWN</code>启动关机流程,这个过程中药根据系统要求回复信息，通常是给指定序号的消息回复指定参数。</p>

<h2 class="wmd-title" id="再次ipl">3. 再次IPL</h2>

<p>这次的IPL步骤和首次完全一样，只不过时间可能会很长（大概在10~20分钟，视机器配置而定），请耐心等待。</p>

<p>这里附上一些过程图</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/12-reipl-01.png" alt="12-reipl-01" title="reipl-01"></p>

<p>图 12-01-再次IPL</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/12-reipl-02.png" alt="12-reipl-02" title="reipl-02"></p>

<p>图 12-02-再次IPL</p>

<p>大机启动完成后，如果TCP/IP配置正确，从PC就可以ping得通大机了</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/13-ping-mf.png" alt="13-ping-mf" title="ping-mf"></p>

<p>图 13-PC ping 大机</p>

<p>来看看DB2的DDF信息</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/14-ddf-info.png" alt="14-ddf-info" title="ddf-info"></p>

<p>图 14-DDF信息</p>

<p>现在登陆大机时链路参数可以使用<code>192.168.16.250</code>端口23进行登陆了</p>

<p>看看再登陆大机时左上角是不是显示了你的ip？</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/15-logon-panel.png" alt="15-logon-panel" title="logon-panel"></p>

<p>图 15-配置TCP/IP后的登陆界面</p>

<p>也许你会发现PC ping 大机可以ping通但是大机ping PC却不行，这是你PC上防火墙的设置导致的，把“文件和打印机回显请求”的流入量开放即可，如图16</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/16-open-firewall.png" alt="16-open-firewall" title="open-firewall"></p>

<p>图 16-开启PC防火墙</p>

<p>再试试ping PC？</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/17-ping-host.png" alt="17-ping-host" title="ping-host"></p>

<p>图 17-大机ping宿主机</p>

<p>通了吧~？</p>

<h2 class="wmd-title" id="配置uss-ssh">4. 配置USS ssh</h2>

<p>在 ISPF COMMAND SHELL 面板输入<code>OEDIT /etc/resolve.conf</code>配置该文件</p>

<blockquote>
  <p>通常来说在z/OS中是大小写不敏感的，但在这里要注意的是我们编辑的是USS（Unix System Service，IBM大型主机平台下类UNIX系统，z/OS必选组件）中的文件，是大小写敏感的，切记切记！</p>
</blockquote>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/18-edit-ssh-01.png" alt="18-edit-ssh-01" title="edit-ssh-01"></p>

<p>图 18-01-配置ssh</p>

<p>仿照图18-02修改</p>

<p><img class="img-responsive" src="http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/18-edit-ssh-02.png" alt="18-edit-ssh-02" title="edit-ssh-02"></p>

<p>图 18-02-配置ssh</p>

<p>保存退出后以相同的方式打开<code>/etc/sshd_config</code></p>

<p>按下面参数进行修改</p>

<pre class="prettyprint prettyprinted" style=""><code><span class="typ">PermitRootLogin</span><span class="pln"> yes
</span><span class="typ">RSAAuthentication</span><span class="pln"> yes
</span><span class="typ">PublicAuthenticatino</span><span class="pln"> yes
</span><span class="typ">AuthorizedKeysFile</span><span class="pln"> </span><span class="pun">.</span><span class="pln">ssh</span><span class="pun">/</span><span class="pln">authorized_keys
</span><span class="typ">PasswordAuthenticatino</span><span class="pln"> yes
</span><span class="typ">PermitEmptyPasswords</span><span class="pln"> </span><span class="kwd">no</span><span class="pln">
</span><span class="typ">ClientAlivelnterval</span><span class="pln"> </span><span class="lit">60</span></code></pre>

<p>至此ssh配置完成，重新IPL后可以使用ssh客户端（Windows下可以用PuTTY）登陆大机</p>

<h1 class="wmd-title" id="五结语">五、结语</h1>

<hr>

<p>至此，Windows下的虚拟大机搭建全部完成。</p>

<p>本文只是简单的介绍了怎样搭建这么一个环境，更为深入的东西需要你自己去查阅文档（比如IBM红皮书、Hercules官方文档等等），授人以鱼不如授人以渔，对吧？</p>

<p>另外，<strong>文中所写仅仅是个人的一些经验所得，难免存在错误与不足，欢迎随时指正！</strong></p>

<p>如果你在搭建过程中遇到了什么问题，也欢迎随时留言探讨！</p>

<blockquote>
  <p>你可以使用自己搭建的虚拟环境来进行一些主机相关的教学、开发、测试或折腾。但请注意一定不要用于商业用途！如果太高调难免18摸会找你麻烦（笑</p>
</blockquote><h1 class="wmd-title" id="六附录资源列表">六、附录：资源列表</h1>

<hr>

<ul>
<li>Hercules：<a href="http://www.hercules-390.org/">http://www.hercules-390.org/</a></li>
<li>WinPcap：<a href="http://www.winpcap.org/">http://www.winpcap.org/</a></li>
<li>CTCI-W32：<a href="http://www.cbttape.org/~fish/ctci-w32-index.html">http://www.cbttape.org/~fish/ctci-w32-index.html</a></li>
<li>Fishlib：<a href="http://www.softdevlabs.com/Hercules/hercgui-index.html">http://www.softdevlabs.com/Hercules/hercgui-index.html</a></li>
<li>HercGUI：<a href="http://www.softdevlabs.com/Hercules/hercgui-index.html">http://www.softdevlabs.com/Hercules/hercgui-index.html</a></li>
<li>IBM Personal Communication：<a href="http://www-03.ibm.com/software/products/en/pcomm">http://www-03.ibm.com/software/products/en/pcomm</a></li>
<li>Vista TN3270：<a href="http://www.tombrennansoftware.com/">http://www.tombrennansoftware.com/</a></li>
<li>VC 2008 运行库：<a href="http://www.microsoft.com/zh-cn/download/details.aspx?id=11895">http://www.microsoft.com/zh-cn/download/details.aspx?id=11895</a></li>
<li>VC 2005 运行库：<a href="http://www.microsoft.com/zh-cn/download/details.aspx?id=5638">http://www.microsoft.com/zh-cn/download/details.aspx?id=5638</a></li>
<li style="color:black;background:black" title="我什么都不知道">我什么都不知道：http://jervan.me/images/how-to-make-a-virtual-environment-of-mainframe-on-windows/zos1.9.txt</li>
</ul>